"0","set.seed(1234567890)"
"0","library(geosphere)"
"0","stations <- read.csv(""stations.csv"",stringsAsFactors = F,fileEncoding = ""latin1"")"
"0","temps <- read.csv(""temps50k.csv"",stringsAsFactors = F)"
"0","st <- merge(stations,temps,by=""station_number"")"
"0","h_distance <- 50000        # These three values are up to the students"
"0","h_date <-27"
"0","h_time <-3600 * 1.5"
"0","a <- 58.413738 #latitude # The point to predict (up to the students)"
"0","b <- 15.623510  #logitude"
"0","date1 <- ""2015-08-23"" # The date to predict (up to the students)"
"0","times <- c(""04:00:00"", ""06:00:00"",""08:00:00"" ,""10:00:00"",""12:00:00"",""14:00:00"", "
"0","           ""16:00:00"",""18:00:00"",""20:00:00"",""22:00:00"",""24:00:00"")"
"0","temp <- vector(length=length(times))"
"0","# Studentsâ€™ code here"
"0","timesf<-as.difftime(times , units = ""sec"")"
"0","pred_date<-as.POSIXlt(as.Date(date1))$yday"
"0","st$yday <-as.POSIXlt(st$date)$yday"
"0","st$sectime <-as.difftime(as.character(st$ time), units= ""secs"" )"
"0","st_filtered<-st[st$date< pred_date ,]"
"0","d1<-distm(st_filtered[,c(""longitude"",""latitude"")], c(b,a),fun=distHaversine)"
"0","func_diff <- function(a,b,p ) {"
"0","  dif <- abs(as.numeric(a - b))"
"0","  ifelse( 2*dif > p , p- dif , dif )"
"0","}"
"0","func <-function(time ,h){"
"0","  dist <- func_diff(time , st$sectime , 86400)"
"0","  exp(-(dist/h)^2)"
"0","}"
"0","k1<-exp(-(d1/h_distance)^2)"
"0","k2<-exp(-(func_diff(pred_date,st_filtered$yday,365)/h_date)^2)"
"0","for(i in 1:length(timesf)){"
"0","  k3<-func(timesf[i],h_time)"
"0","  K<-as.vector(k1)+as.vector(k2)+as.vector(k3)"
"0","  temp[i]<-sum(K*st_filtered$air_temperature)/sum(K)"
"0","  "
"0","}"
"0","temp_mult<-vector(length=length(times))"
"0","for(i in 1:length(timesf)){"
"0","  k3<-func(timesf[i],h_time)"
"0","  K1<-as.vector(k1)*as.vector(k2)*as.vector(k3)"
"0","  temp_mult[i]<-sum(K1*st_filtered$air_temperature)/sum(K1)"
"0","  "
"0","}"
"0","times_ps<-as.POSIXct(times,format=""%H:%M:%S"")"
"0","plot(times_ps,temp, type=""o"",main=""Liknoping '2013-08-23"",col=""blue"",ylim=c(5,20))"
